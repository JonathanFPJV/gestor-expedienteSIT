<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gestor de Expedientes SIT</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <!-- NavegaciÃ³n Principal -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="assets/LogoSIT-R.png" alt="Logo SIT" class="brand-logo">
                <h1>Gestor de Expedientes SIT</h1>
            </div>
            
            <!-- BotÃ³n Hamburguesa (Mobile) -->
            <button class="nav-toggle" aria-label="MenÃº de navegaciÃ³n">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <!-- MenÃº de NavegaciÃ³n -->
            <div class="nav-menu">
                <button id="nav-busqueda" class="nav-btn active">
                    ğŸ” BÃºsqueda
                </button>
                <button id="nav-registro" class="nav-btn">
                    â• Nuevo Expediente
                </button>
                <button id="nav-crud" class="nav-btn">
                    ğŸ“‚ GestiÃ³n de Expedientes
                </button>
                <button id="nav-tarjetas" class="nav-btn">
                    ğŸ« GestiÃ³n de Tarjetas
                </button>
                <button id="nav-actas" class="nav-btn">
                    ğŸ“‹ GestiÃ³n de Actas de Entrega
                </button>
            </div>
        </div>
    </nav>
    
    <!-- Overlay para menÃº mobile -->
    <div class="nav-overlay"></div>

    <!-- SecciÃ³n de BÃºsqueda (Vista por defecto) -->
    <div id="vista-busqueda" class="vista-container active">
        <div class="search-container">
            <h2>ğŸ” BÃºsqueda Avanzada</h2>
            <div class="search-tabs">
                <button id="tab-tarjetas" class="tab-btn active">Buscar Tarjetas</button>
                <button id="tab-expedientes" class="tab-btn">Buscar Expedientes</button>
            </div>
            
            <div id="search-tarjetas" class="search-section">
                <div class="search-input-container">
                    <input type="text" id="search-tarjetas-input" placeholder="Buscar por placa o nÃºmero de tarjeta...">
                    <div class="search-indicator"></div>
                    <div class="search-completed">âœ“</div>
                </div>
                <button id="search-tarjetas-btn">Buscar Tarjetas</button>
                <div id="search-tarjetas-results"></div>
            </div>
            
            <div id="search-expedientes" class="search-section" style="display: none;">
                <div class="search-input-container">
                    <input type="text" id="search-expedientes-input" placeholder="Buscar por expediente...">
                    <div class="search-indicator"></div>
                    <div class="search-completed">âœ“</div>
                </div>
                <button id="search-expedientes-btn">Buscar Expedientes</button>
                <div id="search-expedientes-results"></div>
            </div>
        </div>
    </div>

    <!-- SecciÃ³n de Registro -->
    <div id="vista-registro" class="vista-container">
        <div class="form-container">
            <h2>Nuevo Registro de Expediente</h2>
            <form id="expediente-form">
                <!-- SecciÃ³n Principal del Expediente -->
                <fieldset class="form-section">
                    <legend>InformaciÃ³n Principal</legend>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="numeroExpediente">NÂ° de Expediente:</label>
                            <input type="text" id="numeroExpediente" placeholder="Ej: 53322" required>
                        </div>
                        <div class="form-group">
                            <label for="anioExpediente">AÃ±o:</label>
                            <input type="number" id="anioExpediente" min="2020" max="2030" value="2025" required>
                        </div>
                        <div class="form-group">
                            <label for="numeroResolucion">NÂ° de ResoluciÃ³n:</label>
                            <input type="text" id="numeroResolucion" placeholder="Opcional">
                        </div>
                        <div class="form-group">
                            <label for="fecha">Fecha del Expediente:</label>
                            <input type="date" id="fecha" required>
                        </div>
                    </div>
                </fieldset>

                <!-- SecciÃ³n de Detalles TÃ©cnicos -->
                <fieldset class="form-section">
                    <legend>Detalles TÃ©cnicos</legend>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="informeTecnico">Informe TÃ©cnico:</label>
                            <input type="text" id="informeTecnico" placeholder="Referencia del informe">
                        </div>
                        <div class="form-group">
                            <label for="numeroFichero">NÂ° de Fichero:</label>
                            <input type="text" id="numeroFichero" placeholder="NÃºmero de fichero">
                        </div>
                    </div>
                </fieldset>

                <!-- SecciÃ³n de Empresa -->
                <fieldset class="form-section">
                    <legend>InformaciÃ³n de Empresa</legend>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="nombreEmpresa">Nombre de la Empresa:</label>
                            <input type="text" id="nombreEmpresa" placeholder="RazÃ³n social">
                        </div>
                        <div class="form-group">
                            <label for="unidadNegocio">Unidad de Negocio:</label>
                            <select id="unidadNegocio">
                                <option value="">Seleccionar...</option>
                                <option value="C1">C-1</option>
                                <option value="C2">C-2</option>
                                <option value="C3">C-3</option>
                                <option value="C4">C-4</option>
                                <option value="C5">C-5</option>
                                <option value="C6">C-6</option>
                                <option value="C7">C-7</option>
                                <option value="C8">C-8</option>
                                <option value="C9">C-9</option>
                                <option value="C10">C-10</option>
                                <option value="C11">C-11</option>
                            </select>
                        </div>
                    </div>
                </fieldset>

                <!-- SecciÃ³n de Observaciones -->
                <fieldset class="form-section">
                    <legend>Observaciones</legend>
                    <div class="observaciones-toggle">
                        <button type="button" id="toggle-observaciones" class="toggle-btn">
                            â• Agregar Observaciones
                        </button>
                    </div>
                    <div id="observaciones-container" class="observaciones-container hidden">
                        <div class="form-group">
                            <label for="observaciones">Observaciones Adicionales:</label>
                            <textarea id="observaciones" rows="3" placeholder="InformaciÃ³n adicional relevante..."></textarea>
                        </div>
                    </div>
                </fieldset>

                <!-- SecciÃ³n de Tarjetas -->
                <fieldset class="form-section">
                    <legend>Tarjetas Asociadas</legend>
                    <div id="tarjetas-list"></div>
                    <button type="button" id="agregar-tarjeta-btn">Agregar Tarjeta</button>
                </fieldset>

                <!-- SecciÃ³n de Acta de Entrega -->
                <fieldset class="form-section">
                    <legend>Acta de Entrega (Opcional)</legend>
                    <div class="form-group">
                        <input type="checkbox" id="incluir-acta-entrega" style="width: auto; margin-right: 10px;">
                        <label for="incluir-acta-entrega" style="display: inline;">Registrar Acta de Entrega</label>
                    </div>
                    <div id="acta-entrega-fields" style="display: none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="fechaEntrega">Fecha de Entrega:</label>
                                <input type="date" id="fechaEntrega">
                            </div>
                            <div class="form-group">
                                <label for="n_tarjetas_entregadas">NÂ° de Tarjetas:</label>
                                <input type="number" id="n_tarjetas_entregadas" min="0" placeholder="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="observacionesActa">Observaciones del Acta:</label>
                            <textarea id="observacionesActa" rows="2" placeholder="Observaciones adicionales de la entrega..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="pdf-acta-path">Adjuntar Acta de Entrega (PDF):</label>
                            <input type="text" id="pdf-acta-path" placeholder="NingÃºn archivo seleccionado" readonly>
                            <button type="button" id="seleccionar-pdf-acta-btn" class="toggle-btn">Seleccionar Archivo</button>
                        </div>
                    </div>
                </fieldset>

                <!-- SecciÃ³n de Archivos -->
                <fieldset class="form-section">
                    <legend>Documentos</legend>
                    <div class="form-group">
                        <label for="pdf-file-path">Adjuntar Expediente (PDF):</label>
                        <input type="text" id="pdf-file-path" placeholder="NingÃºn archivo seleccionado" readonly>
                        <button type="button" id="seleccionar-pdf-btn" class="toggle-btn">Seleccionar Archivo</button>
                    </div>
                </fieldset>

                <!-- Campo oculto para compatibilidad -->
                <input type="hidden" id="expediente">
                
                <button type="submit" id="guardar-expediente-btn">Guardar Expediente</button>
            </form>
        </div>
    </div>

    <!-- SecciÃ³n de CRUD Expedientes -->
    <div id="vista-crud" class="vista-container">
        <div class="crud-container">
            <div class="crud-header">
                <h2>ğŸ“‚ GestiÃ³n de Expedientes</h2>
                <div class="crud-actions">
                    <button id="nuevo-expediente-btn" class="btn-primary">
                        â• Nuevo Expediente
                    </button>
                    <div class="search-crud">
                        <input type="text" id="search-crud-input" placeholder="Buscar expedientes..." />
                        <button id="search-crud-btn" class="btn-secondary">ğŸ”</button>
                    </div>
                </div>
            </div>

            <!-- Filtros -->
            <div class="crud-filters">
                <div class="filter-group">
                    <label for="filter-anio">AÃ±o:</label>
                    <select id="filter-anio">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filter-unidad">Unidad:</label>
                    <select id="filter-unidad">
                        <option value="">Todas</option>
                        <option value="C1">C-1</option>
                        <option value="C2">C-2</option>
                        <option value="C3">C-3</option>
                        <option value="C4">C-4</option>
                        <option value="C5">C-5</option>
                        <option value="C6">C-6</option>
                        <option value="C7">C-7</option>
                        <option value="C8">C-8</option>
                        <option value="C9">C-9</option>
                        <option value="C10">C-10</option>
                        <option value="C11">C-11</option>
                    </select>
                </div>
                <button id="limpiar-filtros-btn" class="btn-outline">Limpiar Filtros</button>
            </div>

            <!-- Tabla de Expedientes -->
            <div class="crud-table-container">
                <table id="expedientes-table" class="crud-table">
                    <thead>
                        <tr>
                            <th>NÂ° Expediente</th>
                            <th>AÃ±o</th>
                            <th>Fecha</th>
                            <th>NÂ° ResoluciÃ³n</th>
                            <th>Empresa</th>
                            <th>Unidad</th>
                            <th>Tarjetas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="expedientes-tbody">
                        <!-- Los expedientes se cargarÃ¡n aquÃ­ -->
                    </tbody>
                </table>
            </div>

            <!-- PaginaciÃ³n -->
            <div class="crud-pagination">
                <div class="pagination-info">
                    <span id="pagination-info">Mostrando 0 de 0 expedientes</span>
                </div>
                <div class="pagination-controls">
                    <button id="prev-page" class="btn-outline" disabled>Â« Anterior</button>
                    <span id="page-info">PÃ¡gina 1 de 1</span>
                    <button id="next-page" class="btn-outline" disabled>Siguiente Â»</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SecciÃ³n de GestiÃ³n de Tarjetas -->
    <div id="vista-tarjetas-crud" class="vista-container">
        <div class="crud-container">
            <div class="crud-header">
                <h2>ğŸ« GestiÃ³n de Tarjetas</h2>
                <div class="crud-actions">
                    <button id="nueva-tarjeta-btn" class="btn-primary">
                        â• Nueva Tarjeta
                    </button>
                    <div class="search-crud">
                        <input type="text" id="search-crud-tarjetas-input" placeholder="Buscar por placa o nÃºmero..." />
                        <button id="search-crud-tarjetas-btn" class="btn-secondary">ğŸ”</button>
                    </div>
                </div>
            </div>

            <!-- Filtros -->
            <div class="crud-filters">
                <button id="limpiar-filtros-tarjetas-btn" class="btn-outline">Limpiar Filtros</button>
                <div class="filter-stats">
                    <span id="stats-tarjetas">Total: 0 tarjetas</span>
                </div>
            </div>

            <!-- Tabla de Tarjetas -->
            <div class="crud-table-container">
                <table id="tarjetas-table" class="crud-table">
                    <thead>
                        <tr>
                            <th>Placa</th>
                            <th>NÂ° Tarjeta</th>
                            <th>Expediente</th>
                            <th>Acta de Entrega</th>
                            <th>Fecha CreaciÃ³n</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tarjetas-tbody">
                        <!-- Las tarjetas se cargarÃ¡n aquÃ­ -->
                    </tbody>
                </table>
            </div>

            <!-- PaginaciÃ³n -->
            <div class="crud-pagination">
                <div class="pagination-info">
                    <span id="pagination-info-tarjetas">Mostrando 0 de 0 tarjetas</span>
                </div>
                <div class="pagination-controls">
                    <button id="prev-page-tarjetas" class="btn-outline" disabled>Â« Anterior</button>
                    <span id="page-info-tarjetas">PÃ¡gina 1 de 1</span>
                    <button id="next-page-tarjetas" class="btn-outline" disabled>Siguiente Â»</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SecciÃ³n de GestiÃ³n de Actas de Entrega -->
    <div id="vista-actas-crud" class="vista-container">
        <div class="crud-container">
            <div class="crud-header">
                <h2>ğŸ“‹ GestiÃ³n de Actas de Entrega</h2>
                <div class="crud-actions">
                    <button id="nueva-acta-btn" class="btn-primary">
                        â• Nueva Acta
                    </button>
                    <div class="search-crud">
                        <input type="text" id="search-actas-input" placeholder="Buscar actas..." />
                        <button id="search-actas-btn" class="btn-secondary">ğŸ”</button>
                    </div>
                </div>
            </div>

            <!-- Filtros -->
            <div class="crud-filters">
                <button id="limpiar-filtros-actas-btn" class="btn-outline">Limpiar Filtros</button>
                <div class="filter-stats">
                    <span id="stats-actas">Total: 0 actas</span>
                </div>
            </div>

            <!-- Tabla de Actas -->
            <div class="crud-table-container">
                <table id="actas-table" class="crud-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Fecha Entrega</th>
                            <th>NÂ° Tarjetas</th>
                            <th>PDF</th>
                            <th>Observaciones</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="actas-tbody">
                        <!-- Las actas se cargarÃ¡n aquÃ­ -->
                    </tbody>
                </table>
            </div>

            <!-- PaginaciÃ³n -->
            <div class="crud-pagination">
                <div class="pagination-info">
                    <span id="pagination-info-actas">Mostrando 0 de 0 actas</span>
                </div>
                <div class="pagination-controls">
                    <button id="prev-page-actas" class="btn-outline" disabled>Â« Anterior</button>
                    <span id="page-info-actas">PÃ¡gina 1 de 1</span>
                    <button id="next-page-actas" class="btn-outline" disabled>Siguiente Â»</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Expediente -->
    <div id="modal-expediente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Editar Expediente</h3>
                <button id="modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="modal-expediente-form">
                    <!-- Los campos del formulario se cargarÃ¡n aquÃ­ -->
                </form>
            </div>
            <div class="modal-footer">
                <button id="modal-cancelar" class="btn-outline">Cancelar</button>
                <button id="modal-guardar" class="btn-primary">Guardar Cambios</button>
                <button id="modal-eliminar" class="btn-danger">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Tarjeta -->
    <div id="modal-tarjeta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-tarjeta-title">Nueva Tarjeta</h3>
                <button id="modal-tarjeta-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="modal-tarjeta-form">
                    <!-- Los campos del formulario se cargarÃ¡n dinÃ¡micamente -->
                </form>
            </div>
            <div class="modal-footer">
                <button id="modal-tarjeta-cancelar" class="btn-outline">Cancelar</button>
                <button id="modal-tarjeta-guardar" class="btn-primary">Guardar</button>
                <button id="modal-tarjeta-eliminar" class="btn-danger" style="display: none;">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Acta de Entrega -->
    <div id="modal-acta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-acta-title">Nueva Acta de Entrega</h3>
                <button id="modal-acta-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="modal-acta-form">
                    <!-- Los campos del formulario se cargarÃ¡n dinÃ¡micamente -->
                </form>
            </div>
            <div class="modal-footer">
                <button id="modal-acta-cancelar" class="btn-outline">Cancelar</button>
                <button id="modal-acta-guardar" class="btn-primary">Guardar</button>
                <button id="modal-acta-eliminar" class="btn-danger" style="display: none;">Eliminar</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts de prueba y diagnÃ³stico -->
    <script src="../scripts/test-connection.js"></script>
    <script src="../scripts/test-tarjetas.js"></script>
    <script src="../scripts/test-delete.js"></script>
    <script src="../scripts/diagnostico-db.js"></script>
    <script src="../scripts/auto-migrate-tarjetas.js"></script>
    <script type="module" src="js/main.js"></script>
    <script>
        // ConfiguraciÃ³n de PDF.js worker
        if (typeof window !== 'undefined' && !window.pdfjsWorkerSrc) {
            window.pdfjsWorkerSrc = 'node_modules/pdfjs-dist/build/pdf.worker.js';
        }
        
        // Shortcut para diagnÃ³stico: Ctrl+Alt+D
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.altKey && e.key === 'd') {
                console.clear();
                diagnosticarBaseDatos();
            }
        });
    </script>
</body>
</html>