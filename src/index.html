<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gestor de Expedientes SIT</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <!-- Navegaci√≥n Principal -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="assets/LogoSIT-R.png" alt="Logo SIT" class="brand-logo">
                <h1>Gestor de Expedientes SIT</h1>
            </div>
            
            <!-- Bot√≥n Hamburguesa (Mobile) -->
            <button class="nav-toggle" aria-label="Men√∫ de navegaci√≥n">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <!-- Men√∫ de Navegaci√≥n -->
            <div class="nav-menu">
                <button id="nav-dashboard" class="nav-btn">
                    üìä Dashboard
                </button>
                <button id="nav-busqueda" class="nav-btn active">
                    üîç B√∫squeda
                </button>
                <button id="nav-crud" class="nav-btn">
                    üìÇ Gesti√≥n de Expedientes
                </button>
                <button id="nav-tarjetas" class="nav-btn">
                    üé´ Gesti√≥n de Tarjetas
                </button>
                <button id="nav-actas" class="nav-btn">
                    üìã Gesti√≥n de Actas de Entrega
                </button>
            </div>
        </div>
    </nav>
    
    <!-- Overlay para men√∫ mobile -->
    <div class="nav-overlay"></div>

    <!-- Secci√≥n del Dashboard -->
    <div id="vista-dashboard" class="vista-container">
        <div class="dashboard-container">
            <!-- Header del Dashboard -->
            <div class="dashboard-header">
                <div class="dashboard-title">
                    <span class="icon">üìä</span>
                    <h2>Dashboard - Panel de Control</h2>
                </div>
                <div class="dashboard-actions">
                    <div class="realtime-indicator">
                        <span class="realtime-dot"></span>
                        <span>√öltima actualizaci√≥n: <span id="last-update-time">--:--</span></span>
                    </div>
                    <button id="btn-refresh-dashboard" class="dashboard-btn primary">
                        üîÑ Actualizar
                    </button>
                    <button id="btn-export-dashboard" class="dashboard-btn outline">
                        üì• Exportar
                    </button>
                </div>
            </div>

            <!-- Panel de Filtros del Dashboard -->
            <div class="filters-panel">
                <div class="filters-header" id="toggle-dashboard-filters">
                    <h3>üîç Filtros <span id="active-dashboard-filters-count"></span></h3>
                    <span class="filters-toggle">‚ñº</span>
                </div>
                <div class="filters-content">
                    <div class="filter-group">
                        <label for="dashboard-filter-anio">A√±o</label>
                        <select id="dashboard-filter-anio">
                            <option value="">Todos los a√±os</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="dashboard-filter-unidad">Unidad de Negocio</label>
                        <select id="dashboard-filter-unidad">
                            <option value="">Todas las unidades</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="dashboard-filter-estado">Estado de Tarjeta</label>
                        <select id="dashboard-filter-estado">
                            <option value="">Todos los estados</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="dashboard-filter-fecha-desde">Desde</label>
                        <input type="date" id="dashboard-filter-fecha-desde">
                    </div>
                    <div class="filter-group">
                        <label for="dashboard-filter-fecha-hasta">Hasta</label>
                        <input type="date" id="dashboard-filter-fecha-hasta">
                    </div>
                    <div class="filter-group">
                        <label for="dashboard-filter-rango">Rango Predefinido</label>
                        <select id="dashboard-filter-rango">
                            <option value="">Personalizado</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button id="btn-apply-dashboard-filters" class="dashboard-btn primary">Aplicar</button>
                        <button id="btn-clear-dashboard-filters" class="dashboard-btn outline">Limpiar</button>
                    </div>
                </div>
            </div>

            <!-- Tarjetas de Estad√≠sticas -->
            <div class="stats-grid">
                <div class="stat-card orange">
                    <div class="stat-card-header">
                        <span class="stat-card-title">Total Tarjetas</span>
                        <div class="stat-card-icon">üé´</div>
                    </div>
                    <div class="stat-card-value" id="stat-total-tarjetas">0</div>
                    <div class="stat-card-trend neutral">
                        <span>Registradas en el sistema</span>
                    </div>
                </div>
                
                <div class="stat-card green">
                    <div class="stat-card-header">
                        <span class="stat-card-title">Tarjetas Activas</span>
                        <div class="stat-card-icon">‚úÖ</div>
                    </div>
                    <div class="stat-card-value" id="stat-tarjetas-activas">0</div>
                    <div class="stat-card-trend up">
                        <span>En circulaci√≥n</span>
                    </div>
                </div>
                
                <div class="stat-card blue">
                    <div class="stat-card-header">
                        <span class="stat-card-title">Total Expedientes</span>
                        <div class="stat-card-icon">üìÇ</div>
                    </div>
                    <div class="stat-card-value" id="stat-total-expedientes">0</div>
                    <div class="stat-card-trend neutral">
                        <span>Procesados</span>
                    </div>
                </div>
                
                
                <div class="stat-card blue">
                    <div class="stat-card-header">
                        <span class="stat-card-title">Expedientes del Mes</span>
                        <div class="stat-card-icon">üìÖ</div>
                    </div>
                    <div class="stat-card-value" id="stat-expedientes-mes">0</div>
                    <div class="stat-card-trend neutral">
                        <span>Este mes</span>
                    </div>
                </div>
                
                <div class="stat-card orange">
                    <div class="stat-card-header">
                        <span class="stat-card-title">Tarjetas Canceladas</span>
                        <div class="stat-card-icon">‚ùå</div>
                    </div>
                    <div class="stat-card-value" id="stat-tarjetas-canceladas">0</div>
                    <div class="stat-card-trend down">
                        <span>Dadas de baja</span>
                    </div>
                </div>
            </div>

            <!-- Grid de Gr√°ficos -->
            <div class="charts-grid">
                <!-- Tarjetas por Estado -->
                <div class="chart-card">
                    <div class="chart-header">
                        <span class="chart-title">üé´ Tarjetas por Estado</span>
                    </div>
                    <div class="chart-body">
                        <div class="chart-loading">
                            <div class="spinner"></div>
                            <span>Cargando...</span>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="chart-tarjetas-estado"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Expedientes por Mes -->
                <div class="chart-card">
                    <div class="chart-header">
                        <span class="chart-title">üìÖ Expedientes por Mes</span>
                    </div>
                    <div class="chart-body">
                        <div class="chart-loading">
                            <div class="spinner"></div>
                            <span>Cargando...</span>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="chart-expedientes-mes"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Tarjetas por Unidad de Negocio -->
                <div class="chart-card">
                    <div class="chart-header">
                        <span class="chart-title">üè¢ Tarjetas por Unidad de Negocio</span>
                    </div>
                    <div class="chart-body">
                        <div class="chart-loading">
                            <div class="spinner"></div>
                            <span>Cargando...</span>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="chart-tarjetas-unidad"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Entregas -->
                <div class="chart-card">
                    <div class="chart-header">
                        <span class="chart-title">üìã Estado de Entregas</span>
                    </div>
                    <div class="chart-body">
                        <div class="chart-loading">
                            <div class="spinner"></div>
                            <span>Cargando...</span>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="chart-entregas"></canvas>
                        </div>
                    </div>
                </div>
                
                
                <!-- Expedientes por A√±o -->
                <div class="chart-card full-width">
                    <div class="chart-header">
                        <span class="chart-title">üìä Expedientes por A√±o</span>
                    </div>
                    <div class="chart-body">
                        <div class="chart-loading">
                            <div class="spinner"></div>
                            <span>Cargando...</span>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="chart-expedientes-anio"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Secci√≥n de B√∫squeda (Vista por defecto) -->
    <div id="vista-busqueda" class="vista-container active">
        <div class="search-container">
            <h2>üîç B√∫squeda Avanzada</h2>
            <div class="search-tabs">
                <button id="tab-tarjetas" class="tab-btn active">Buscar Tarjetas</button>
                <button id="tab-expedientes" class="tab-btn">Buscar Expedientes</button>
            </div>
            
            <div id="search-tarjetas" class="search-section">
                <div class="search-input-container">
                    <input type="text" id="search-tarjetas-input" placeholder="Buscar por placa o n√∫mero de tarjeta...">
                    <div class="search-indicator"></div>
                    <div class="search-completed">‚úì</div>
                </div>
                <button id="search-tarjetas-btn">Buscar Tarjetas</button>
                <div id="search-tarjetas-results"></div>
            </div>
            
            <div id="search-expedientes" class="search-section" style="display: none;">
                <div class="search-input-container">
                    <input type="text" id="search-expedientes-input" placeholder="Buscar por N¬∞ de expediente o N¬∞ de resoluci√≥n...">
                    <div class="search-indicator"></div>
                    <div class="search-completed">‚úì</div>
                </div>
                <button id="search-expedientes-btn">Buscar Expedientes</button>
                <div id="search-expedientes-results"></div>
            </div>
        </div>
    </div>

    <!-- Secci√≥n de Registro -->
    <div id="vista-registro" class="vista-container">
        <div class="form-container">
            <h2>üìã Nuevo Registro de Expediente</h2>
            <form id="expediente-form">
                <!-- Secci√≥n de Archivos (PDF) - movido al inicio -->
                <fieldset class="form-section">
                    <legend>üìÑ Cargar Documento del Expediente</legend>
                    <div class="form-group">
                        <label for="pdf-file-path">Adjuntar Expediente (PDF):</label>
                        <input type="text" id="pdf-file-path" placeholder="Ning√∫n archivo seleccionado" readonly>
                        <button type="button" id="seleccionar-pdf-btn" class="toggle-btn">üìÅ Seleccionar PDF y Extraer Texto</button>
                    </div>
                    <!-- Indicador de estado OCR -->
                    <div id="ocr-status" class="ocr-status" style="display: none;">
                        <div class="ocr-progress">
                            <div id="ocr-spinner" class="spinner"></div>
                            <span id="ocr-message" class="ocr-message">Procesando documento con OCR...</span>
                        </div>
                    </div>
                </fieldset>

                <!-- Secci√≥n Principal del Expediente -->
                <fieldset class="form-section">
                    <legend>Informaci√≥n Principal</legend>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="numeroExpediente">N¬∞ de Expediente:</label>
                            <input type="text" id="numeroExpediente" placeholder="Ej: 53322" required>
                        </div>
                        <div class="form-group">
                            <label for="anioExpediente">A√±o:</label>
                            <input type="number" id="anioExpediente" min="2020" max="2030" value="2025" required>
                        </div>
                        <div class="form-group">
                            <label for="numeroResolucion">N¬∞ de Resoluci√≥n:</label>
                            <input type="text" id="numeroResolucion" placeholder="Opcional">
                        </div>
                        <div class="form-group">
                            <label for="fecha">Fecha del Expediente:</label>
                            <input type="date" id="fecha" required>
                        </div>
                    </div>
                </fieldset>

                <!-- Secci√≥n de Detalles T√©cnicos -->
                <fieldset class="form-section">
                    <legend>Detalles T√©cnicos</legend>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="informeTecnico">Informe T√©cnico:</label>
                            <input type="text" id="informeTecnico" placeholder="Referencia del informe">
                        </div>
                        <div class="form-group">
                            <label for="numeroFichero">N¬∞ de Fichero:</label>
                            <input type="text" id="numeroFichero" placeholder="N√∫mero de fichero">
                        </div>
                    </div>
                </fieldset>

                <!-- Secci√≥n de Empresa -->
                <fieldset class="form-section">
                    <legend>Informaci√≥n de Empresa</legend>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="nombreEmpresa">Nombre de la Empresa:</label>
                            <input type="text" id="nombreEmpresa" placeholder="Raz√≥n social">
                        </div>
                        <div class="form-group">
                            <label for="unidadNegocio">Unidad de Negocio:</label>
                            <select id="unidadNegocio">
                                <option value="">Seleccionar...</option>
                                <option value="C1">C-1</option>
                                <option value="C2">C-2</option>
                                <option value="C3">C-3</option>
                                <option value="C4">C-4</option>
                                <option value="C5">C-5</option>
                                <option value="C6">C-6</option>
                                <option value="C7">C-7</option>
                                <option value="C8">C-8</option>
                                <option value="C9">C-9</option>
                                <option value="C10">C-10</option>
                                <option value="C11">C-11</option>
                            </select>
                        </div>
                    </div>
                </fieldset>

                <!-- Secci√≥n de Observaciones -->
                <fieldset class="form-section">
                    <legend>Observaciones</legend>
                    <div class="observaciones-toggle">
                        <button type="button" id="toggle-observaciones" class="toggle-btn">
                            ‚ûï Agregar Observaciones
                        </button>
                    </div>
                    <div id="observaciones-container" class="observaciones-container hidden">
                        <div class="form-group">
                            <label for="observaciones">Observaciones Adicionales:</label>
                            <textarea id="observaciones" rows="3" placeholder="Informaci√≥n adicional relevante..."></textarea>
                        </div>
                    </div>
                </fieldset>

                <!-- Secci√≥n de Tarjetas -->
                <fieldset class="form-section">
                    <legend>Tarjetas Asociadas</legend>
                    
                    <!-- Opci√≥n 1: Procesamiento por Lotes (OCR) -->
                    <div class="form-group" style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin-top: 0; color: #1976d2;">üìÑ Procesamiento Autom√°tico (OCR)</h4>
                        <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
                            Sube un PDF de m√∫ltiples p√°ginas y el sistema extraer√° autom√°ticamente el <strong>C√≥digo √önico</strong> y la <strong>Placa de Rodaje</strong> de cada p√°gina.
                        </p>
                        
                        <div class="form-group">
                            <label for="pdf-batch-path">PDF de Tarjetas (M√∫ltiples P√°ginas):</label>
                            <input type="text" id="pdf-batch-path" placeholder="Ning√∫n archivo seleccionado" readonly>
                            <button type="button" id="seleccionar-pdf-batch-btn" class="toggle-btn">
                                üìÅ Seleccionar PDF y Procesar
                            </button>
                        </div>

                        <!-- Progreso del procesamiento -->
                        <div id="batch-progress-container" style="display: none; margin-top: 15px;">
                            <div class="progress" style="height: 25px; background: #e0e0e0; border-radius: 5px; overflow: hidden;">
                                <div id="batch-progress-bar" 
                                     class="progress-bar" 
                                     role="progressbar" 
                                     style="width: 0%; background: #4CAF50; color: white; font-weight: bold; line-height: 25px; text-align: center; transition: width 0.3s ease;"
                                     aria-valuenow="0" 
                                     aria-valuemin="0" 
                                     aria-valuemax="100">
                                    0%
                                </div>
                            </div>
                            <p id="batch-status-message" class="text-info" style="margin-top: 10px; font-weight: 500;"></p>
                        </div>

                        <!-- Tabla de resultados del batch -->
                        <div id="batch-results-container" style="display: none; margin-top: 20px;">
                            <h5>üìä Tarjetas Detectadas:</h5>
                            <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 5px;">
                                <table id="batch-results-table" class="table table-striped" style="width: 100%; margin: 0;">
                                    <thead style="background: #f5f5f5; position: sticky; top: 0;">
                                        <tr>
                                            <th style="width: 60px; text-align: center;">Estado</th>
                                            <th style="width: 80px; text-align: center;">P√°gina</th>
                                            <th style="width: 25%;">C√≥digo √önico</th>
                                            <th style="width: 20%;">Placa de Rodaje</th>
                                            <th style="width: 25%;">PDF Generado</th>
                                            <th style="width: 100px; text-align: center;">Campos</th>
                                            <th style="width: 120px; text-align: center;">Acci√≥n</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Filas se agregan din√°micamente -->
                                    </tbody>
                                </table>
                            </div>
                            <button type="button" id="dividir-pdf-btn" class="toggle-btn" style="margin-top: 10px; background: #2196F3;">
                                üìÅ Dividir PDF y Guardar por C√≥digo √önico
                            </button>
                            <button type="button" id="aplicar-tarjetas-batch-btn" class="toggle-btn" style="margin-top: 10px;">
                                ‚úÖ Aplicar Todas las Tarjetas Detectadas
                            </button>
                        </div>
                    </div>

                    <!-- Separador -->
                    <div style="border-top: 2px dashed #ccc; margin: 20px 0; position: relative;">
                        <span style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: white; padding: 0 10px; color: #999; font-size: 0.9em;">
                            O agregar manualmente
                        </span>
                    </div>

                    <!-- Opci√≥n 2: Agregar Manualmente -->
                    <div id="tarjetas-list"></div>
                    <button type="button" id="agregar-tarjeta-btn">Agregar Tarjeta</button>
                </fieldset>

                <!-- Secci√≥n de Acta de Entrega -->
                <fieldset class="form-section">
                    <legend>Acta de Entrega (Opcional)</legend>
                    <div class="form-group">
                        <input type="checkbox" id="incluir-acta-entrega" style="width: auto; margin-right: 10px;">
                        <label for="incluir-acta-entrega" style="display: inline;">Registrar Acta de Entrega</label>
                    </div>
                    <div id="acta-entrega-fields" style="display: none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="fechaEntrega">Fecha de Entrega:</label>
                                <input type="date" id="fechaEntrega">
                            </div>
                            <div class="form-group">
                                <label for="n_tarjetas_entregadas">N¬∞ de Tarjetas:</label>
                                <input type="number" id="n_tarjetas_entregadas" min="0" placeholder="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="observacionesActa">Observaciones del Acta:</label>
                            <textarea id="observacionesActa" rows="2" placeholder="Observaciones adicionales de la entrega..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="pdf-acta-path">Adjuntar Acta de Entrega (PDF):</label>
                            <input type="text" id="pdf-acta-path" placeholder="Ning√∫n archivo seleccionado" readonly>
                            <button type="button" id="seleccionar-pdf-acta-btn" class="toggle-btn">Seleccionar Archivo</button>
                            <button type="button" id="procesar-acta-ocr-btn" class="toggle-btn" style="background: #9C27B0; margin-left: 10px;">
                                üîç Extraer Datos con OCR
                            </button>
                        </div>
                        
                        <!-- Contenedor de progreso OCR para Acta -->
                        <div id="acta-ocr-progress" style="display: none; margin-top: 15px; padding: 15px; background: #f5f5f5; border-radius: 5px;">
                            <div style="margin-bottom: 10px;">
                                <strong id="acta-ocr-status">üîÑ Procesando acta con OCR...</strong>
                            </div>
                            <div class="progress-bar-container" style="height: 25px; background: #e0e0e0; border-radius: 5px; overflow: hidden;">
                                <div id="acta-ocr-progress-bar" class="progress-bar" style="width: 0%; height: 100%; background: #9C27B0; transition: width 0.3s; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                    0%
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <!-- (Secci√≥n de Archivos movida al inicio del formulario) -->

                <!-- Campo oculto para compatibilidad -->
                <input type="hidden" id="expediente">
                
                <div class="form-buttons">
                    <button type="button" id="cancelar-expediente-btn" class="btn-cancelar">
                        ‚ùå Cancelar
                    </button>
                    <button type="submit" id="guardar-expediente-btn" class="btn-guardar">
                        üíæ Guardar Expediente
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Secci√≥n de CRUD Expedientes -->
    <div id="vista-crud" class="vista-container">
        <div class="crud-container">
            <div class="crud-header">
                <h2>üìÇ Gesti√≥n de Expedientes</h2>
                <div class="crud-actions">
                    <div class="export-group">
                        <button id="exportar-excel-btn" class="btn-export-excel" 
                                title="Exportar TODOS los expedientes que coincidan con los filtros aplicados">
                            üìä Exportar Excel
                        </button>
                        <span class="export-help-icon" title="üí° TIP: La exportaci√≥n respeta los filtros activos y exporta TODOS los datos (no solo la p√°gina actual). Si no hay filtros, exporta todo.">
                            ‚ÑπÔ∏è
                        </span>
                    </div>
                    <button id="nuevo-expediente-btn" class="btn-primary">
                        ‚ûï Nuevo Expediente
                    </button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="crud-filters">
                <div class="filter-group filter-search-group">
                    <label for="search-crud-input">üîç B√∫squeda R√°pida:</label>
                    <div class="search-input-wrapper">
                        <input type="text" 
                               id="search-crud-input" 
                               placeholder="Buscar en la tabla (N¬∞ Expediente, Resoluci√≥n, Empresa...)">
                        <button id="clear-search-crud" class="clear-search-btn" style="display: none;">√ó</button>
                    </div>
                </div>
                <div class="filter-group">
                    <label for="filter-anio">A√±o:</label>
                    <select id="filter-anio">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filter-unidad">Unidad:</label>
                    <select id="filter-unidad">
                        <option value="">Todas</option>
                        <option value="C1">C-1</option>
                        <option value="C2">C-2</option>
                        <option value="C3">C-3</option>
                        <option value="C4">C-4</option>
                        <option value="C5">C-5</option>
                        <option value="C6">C-6</option>
                        <option value="C7">C-7</option>
                        <option value="C8">C-8</option>
                        <option value="C9">C-9</option>
                        <option value="C10">C-10</option>
                        <option value="C11">C-11</option>
                    </select>
                </div>
                <button id="limpiar-filtros-btn" class="btn-outline">Limpiar Filtros</button>
            </div>

            <!-- Tabla de Expedientes -->
            <div class="crud-table-container">
                <table id="expedientes-table" class="crud-table">
                    <thead>
                        <tr>
                            <th>N¬∞ Expediente</th>
                            <th>A√±o</th>
                            <th>Fecha</th>
                            <th>N¬∞ Resoluci√≥n</th>
                            <th>Empresa</th>
                            <th>U. Negocio</th>
                            <th>Tarjetas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="expedientes-tbody">
                        <!-- Los expedientes se cargar√°n aqu√≠ -->
                    </tbody>
                </table>
            </div>

            <!-- Paginaci√≥n -->
            <div class="crud-pagination">
                <div class="pagination-info">
                    <span id="pagination-info">Mostrando 0 de 0 expedientes</span>
                </div>
                <div class="pagination-controls">
                    <button id="prev-page" class="btn-outline" disabled>¬´ Anterior</button>
                    <span id="page-info">P√°gina 1 de 1</span>
                    <button id="next-page" class="btn-outline" disabled>Siguiente ¬ª</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Secci√≥n de Gesti√≥n de Tarjetas -->
    <div id="vista-tarjetas-crud" class="vista-container">
        <div class="crud-container">
            <div class="crud-header">
                <h2>üé´ Gesti√≥n de Tarjetas</h2>
                <div class="crud-actions">
                    <button id="nueva-tarjeta-btn" class="btn-primary">
                        ‚ûï Nueva Tarjeta
                    </button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="crud-filters">
                <div class="filter-group filter-search-group">
                    <label for="search-tarjetas-crud-input">üîç B√∫squeda R√°pida:</label>
                    <div class="search-input-wrapper">
                        <input type="text" 
                               id="search-tarjetas-crud-input" 
                               placeholder="Buscar en la tabla (Placa, N¬∞ Tarjeta, Estado...)">
                        <button id="clear-search-tarjetas" class="clear-search-btn" style="display: none;">√ó</button>
                    </div>
                </div>
                <button id="limpiar-filtros-tarjetas-btn" class="btn-outline">Limpiar Filtros</button>
                <div class="filter-stats">
                    <span id="stats-tarjetas">Total: 0 tarjetas</span>
                </div>
            </div>

            <!-- Tabla de Tarjetas -->
            <div class="crud-table-container">
                <table id="tarjetas-table" class="crud-table">
                    <thead>
                        <tr>
                            <th>Placa</th>
                            <th>N¬∞ Tarjeta</th>
                            <th>Expediente</th>
                            <th>Acta de Entrega</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tarjetas-tbody">
                        <!-- Las tarjetas se cargar√°n aqu√≠ -->
                    </tbody>
                </table>
            </div>

            <!-- Paginaci√≥n -->
            <div class="crud-pagination">
                <div class="pagination-info">
                    <span id="pagination-info-tarjetas">Mostrando 0 de 0 tarjetas</span>
                </div>
                <div class="pagination-controls">
                    <button id="prev-page-tarjetas" class="btn-outline" disabled>¬´ Anterior</button>
                    <span id="page-info-tarjetas">P√°gina 1 de 1</span>
                    <button id="next-page-tarjetas" class="btn-outline" disabled>Siguiente ¬ª</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Secci√≥n de Gesti√≥n de Actas de Entrega -->
    <div id="vista-actas-crud" class="vista-container">
        <div class="crud-container">
            <div class="crud-header">
                <h2>üìã Gesti√≥n de Actas de Entrega</h2>
                <div class="crud-actions">
                    <button id="nueva-acta-btn" class="btn-primary">
                        ‚ûï Nueva Acta
                    </button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="crud-filters">
                <div class="filter-group filter-search-group">
                    <label for="search-actas-crud-input">üîç B√∫squeda R√°pida:</label>
                    <div class="search-input-wrapper">
                        <input type="text" 
                               id="search-actas-crud-input" 
                               placeholder="Buscar en la tabla (N¬∞ Expediente, Fecha, Observaciones...)">
                        <button id="clear-search-actas" class="clear-search-btn" style="display: none;">√ó</button>
                    </div>
                </div>
                <button id="limpiar-filtros-actas-btn" class="btn-outline">Limpiar Filtros</button>
                <div class="filter-stats">
                    <span id="stats-actas">Total: 0 actas</span>
                </div>
            </div>

            <!-- Tabla de Actas -->
            <div class="crud-table-container">
                <table id="actas-table" class="crud-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Fecha Entrega</th>
                            <th>N¬∞ Tarjetas</th>
                            <th>PDF</th>
                            <th>Observaciones</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="actas-tbody">
                        <!-- Las actas se cargar√°n aqu√≠ -->
                    </tbody>
                </table>
            </div>

            <!-- Paginaci√≥n -->
            <div class="crud-pagination">
                <div class="pagination-info">
                    <span id="pagination-info-actas">Mostrando 0 de 0 actas</span>
                </div>
                <div class="pagination-controls">
                    <button id="prev-page-actas" class="btn-outline" disabled>¬´ Anterior</button>
                    <span id="page-info-actas">P√°gina 1 de 1</span>
                    <button id="next-page-actas" class="btn-outline" disabled>Siguiente ¬ª</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Expediente -->
    <div id="modal-expediente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Editar Expediente</h3>
                <button id="modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="modal-expediente-form">
                    <!-- Los campos del formulario se cargar√°n aqu√≠ -->
                </form>
            </div>
            <div class="modal-footer">
                <button id="modal-cancelar" class="btn-outline">Cancelar</button>
                <button id="modal-guardar" class="btn-primary">Guardar Cambios</button>
                <button id="modal-eliminar" class="btn-danger">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Tarjeta -->
    <div id="modal-tarjeta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-tarjeta-title">Nueva Tarjeta</h3>
                <button id="modal-tarjeta-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="modal-tarjeta-form">
                    <!-- Los campos del formulario se cargar√°n din√°micamente -->
                </form>
            </div>
            <div class="modal-footer">
                <button id="modal-tarjeta-cancelar" class="btn-outline">Cancelar</button>
                <button id="modal-tarjeta-guardar" class="btn-primary">Guardar</button>
                <button id="modal-tarjeta-eliminar" class="btn-danger" style="display: none;">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Acta de Entrega -->
    <div id="modal-acta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-acta-title">Nueva Acta de Entrega</h3>
                <button id="modal-acta-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="modal-acta-form">
                    <!-- Los campos del formulario se cargar√°n din√°micamente -->
                </form>
            </div>
            <div class="modal-footer">
                <button id="modal-acta-cancelar" class="btn-outline">Cancelar</button>
                <button id="modal-acta-guardar" class="btn-primary">Guardar</button>
                <button id="modal-acta-eliminar" class="btn-danger" style="display: none;">Eliminar</button>
            </div>
        </div>
    </div>
    
    <!-- Script de migraci√≥n autom√°tica -->
    <script src="../scripts/auto-migrate-tarjetas.js"></script>
    
    <!-- Chart.js para gr√°ficos del Dashboard -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- Librer√≠as para OCR: PDF.js + Tesseract.js + pdf-lib -->
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script>
        // Configurar PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
        
        // Exponer pdf-lib globalmente para los m√≥dulos
        // pdf-lib se carga como PDFLib en el objeto global window
        if (typeof PDFLib === 'undefined') {
            console.error('‚ùå Error: pdf-lib no se carg√≥ correctamente');
        } else {
            window.PDFLib = PDFLib;
            console.log('‚úÖ pdf-lib expuesto como window.PDFLib:', PDFLib);
        }
        
        console.log('üìö Librer√≠as OCR cargadas: PDF.js, Tesseract.js y pdf-lib');
    </script>
    
    <script type="module" src="js/main.js"></script>
    <script>
        // Configuraci√≥n adicional
        if (typeof window !== 'undefined' && !window.pdfjsWorkerSrc) {
            window.pdfjsWorkerSrc = 'node_modules/pdfjs-dist/build/pdf.worker.js';
        }
        
        // Shortcut para diagn√≥stico: Ctrl+Alt+D
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.altKey && e.key === 'd') {
                console.clear();
                diagnosticarBaseDatos();
            }
        });
    </script>
</body>
</html>