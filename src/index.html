<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gestor de Expedientes SIT</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <!-- Navegaci√≥n Principal -->
    <nav class="main-nav">
        <div class="nav-brand">
            <h1>üìã Gestor de Expedientes SIT</h1>
        </div>
        <div class="nav-menu">
            <button id="nav-busqueda" class="nav-btn active">
                üîç B√∫squeda
            </button>
            <button id="nav-registro" class="nav-btn">
                ‚ûï Nuevo Expediente
            </button>
            <button id="nav-crud" class="nav-btn">
                üìÇ Gesti√≥n de Expedientes
            </button>
            <button id="nav-tarjetas" class="nav-btn">
                üé´ Gesti√≥n de Tarjetas
            </button>
        </div>
    </nav>

    <!-- Secci√≥n de B√∫squeda (Vista por defecto) -->
    <div id="vista-busqueda" class="vista-container active">
        <div class="search-container">
            <h2>üîç B√∫squeda Avanzada</h2>
            <div class="search-tabs">
                <button id="tab-tarjetas" class="tab-btn active">Buscar Tarjetas</button>
                <button id="tab-expedientes" class="tab-btn">Buscar Expedientes</button>
            </div>
            
            <div id="search-tarjetas" class="search-section">
                <div class="search-input-container">
                    <input type="text" id="search-tarjetas-input" placeholder="Buscar por placa o n√∫mero de tarjeta...">
                    <div class="search-indicator"></div>
                    <div class="search-completed">‚úì</div>
                </div>
                <button id="search-tarjetas-btn">Buscar Tarjetas</button>
                <div id="search-tarjetas-results"></div>
            </div>
            
            <div id="search-expedientes" class="search-section" style="display: none;">
                <div class="search-input-container">
                    <input type="text" id="search-expedientes-input" placeholder="Buscar por expediente...">
                    <div class="search-indicator"></div>
                    <div class="search-completed">‚úì</div>
                </div>
                <button id="search-expedientes-btn">Buscar Expedientes</button>
                <div id="search-expedientes-results"></div>
            </div>
        </div>
    </div>

    <!-- Secci√≥n de Registro -->
    <div id="vista-registro" class="vista-container">
        <div class="form-container">
            <h2>Nuevo Registro de Expediente</h2>
            <form id="expediente-form">
                <!-- Secci√≥n Principal del Expediente -->
                <fieldset class="form-section">
                    <legend>Informaci√≥n Principal</legend>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="numeroExpediente">N¬∞ de Expediente:</label>
                            <input type="text" id="numeroExpediente" placeholder="Ej: 53322" required>
                        </div>
                        <div class="form-group">
                            <label for="anioExpediente">A√±o:</label>
                            <input type="number" id="anioExpediente" min="2020" max="2030" value="2025" required>
                        </div>
                        <div class="form-group">
                            <label for="numeroResolucion">N¬∞ de Resoluci√≥n:</label>
                            <input type="text" id="numeroResolucion" placeholder="Opcional">
                        </div>
                        <div class="form-group">
                            <label for="fecha">Fecha del Expediente:</label>
                            <input type="date" id="fecha" required>
                        </div>
                    </div>
                </fieldset>

                <!-- Secci√≥n de Detalles T√©cnicos -->
                <fieldset class="form-section">
                    <legend>Detalles T√©cnicos</legend>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="informeTecnico">Informe T√©cnico:</label>
                            <input type="text" id="informeTecnico" placeholder="Referencia del informe">
                        </div>
                        <div class="form-group">
                            <label for="numeroFichero">N¬∞ de Fichero:</label>
                            <input type="text" id="numeroFichero" placeholder="N√∫mero de fichero">
                        </div>
                    </div>
                </fieldset>

                <!-- Secci√≥n de Empresa -->
                <fieldset class="form-section">
                    <legend>Informaci√≥n de Empresa</legend>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="nombreEmpresa">Nombre de la Empresa:</label>
                            <input type="text" id="nombreEmpresa" placeholder="Raz√≥n social">
                        </div>
                        <div class="form-group">
                            <label for="unidadNegocio">Unidad de Negocio:</label>
                            <select id="unidadNegocio">
                                <option value="">Seleccionar...</option>
                                <option value="C1">C-1</option>
                                <option value="C2">C-2</option>
                                <option value="C3">C-3</option>
                                <option value="C4">C-4</option>
                                <option value="C5">C-5</option>
                                <option value="C6">C-6</option>
                                <option value="C7">C-7</option>
                                <option value="C8">C-8</option>
                                <option value="C9">C-9</option>
                                <option value="C10">C-10</option>
                                <option value="C11">C-11</option>
                            </select>
                        </div>
                    </div>
                </fieldset>

                <!-- Secci√≥n de Observaciones -->
                <fieldset class="form-section">
                    <legend>Observaciones</legend>
                    <div class="observaciones-toggle">
                        <button type="button" id="toggle-observaciones" class="toggle-btn">
                            ‚ûï Agregar Observaciones
                        </button>
                    </div>
                    <div id="observaciones-container" class="observaciones-container hidden">
                        <div class="form-group">
                            <label for="observaciones">Observaciones Adicionales:</label>
                            <textarea id="observaciones" rows="3" placeholder="Informaci√≥n adicional relevante..."></textarea>
                        </div>
                    </div>
                </fieldset>

                <!-- Secci√≥n de Tarjetas -->
                <fieldset class="form-section">
                    <legend>Tarjetas Asociadas</legend>
                    <div id="tarjetas-list"></div>
                    <button type="button" id="agregar-tarjeta-btn">Agregar Tarjeta</button>
                </fieldset>

                <!-- Secci√≥n de Acta de Entrega -->
                <fieldset class="form-section">
                    <legend>Acta de Entrega (Opcional)</legend>
                    <div class="form-group">
                        <input type="checkbox" id="incluir-acta-entrega" style="width: auto; margin-right: 10px;">
                        <label for="incluir-acta-entrega" style="display: inline;">Registrar Acta de Entrega</label>
                    </div>
                    <div id="acta-entrega-fields" style="display: none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="fechaEntrega">Fecha de Entrega:</label>
                                <input type="date" id="fechaEntrega">
                            </div>
                            <div class="form-group">
                                <label for="n_tarjetas_entregadas">N¬∞ de Tarjetas:</label>
                                <input type="number" id="n_tarjetas_entregadas" min="0" placeholder="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="observacionesActa">Observaciones del Acta:</label>
                            <textarea id="observacionesActa" rows="2" placeholder="Observaciones adicionales de la entrega..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="pdf-acta-path">Adjuntar Acta de Entrega (PDF):</label>
                            <input type="text" id="pdf-acta-path" placeholder="Ning√∫n archivo seleccionado" readonly>
                            <button type="button" id="seleccionar-pdf-acta-btn" class="toggle-btn">Seleccionar Archivo</button>
                        </div>
                    </div>
                </fieldset>

                <!-- Secci√≥n de Archivos -->
                <fieldset class="form-section">
                    <legend>Documentos</legend>
                    <div class="form-group">
                        <label for="pdf-file-path">Adjuntar Expediente (PDF):</label>
                        <input type="text" id="pdf-file-path" placeholder="Ning√∫n archivo seleccionado" readonly>
                        <button type="button" id="seleccionar-pdf-btn" class="toggle-btn">Seleccionar Archivo</button>
                    </div>
                </fieldset>

                <!-- Campo oculto para compatibilidad -->
                <input type="hidden" id="expediente">
                
                <button type="submit" id="guardar-expediente-btn">Guardar Expediente</button>
            </form>
        </div>
    </div>

    <!-- Secci√≥n de CRUD Expedientes -->
    <div id="vista-crud" class="vista-container">
        <div class="crud-container">
            <div class="crud-header">
                <h2>üìÇ Gesti√≥n de Expedientes</h2>
                <div class="crud-actions">
                    <button id="nuevo-expediente-btn" class="btn-primary">
                        ‚ûï Nuevo Expediente
                    </button>
                    <div class="search-crud">
                        <input type="text" id="search-crud-input" placeholder="Buscar expedientes..." />
                        <button id="search-crud-btn" class="btn-secondary">üîç</button>
                    </div>
                </div>
            </div>

            <!-- Filtros -->
            <div class="crud-filters">
                <div class="filter-group">
                    <label for="filter-anio">A√±o:</label>
                    <select id="filter-anio">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filter-unidad">Unidad:</label>
                    <select id="filter-unidad">
                        <option value="">Todas</option>
                        <option value="C1">C-1</option>
                        <option value="C2">C-2</option>
                        <option value="C3">C-3</option>
                        <option value="C4">C-4</option>
                        <option value="C5">C-5</option>
                        <option value="C6">C-6</option>
                        <option value="C7">C-7</option>
                        <option value="C8">C-8</option>
                        <option value="C9">C-9</option>
                        <option value="C10">C-10</option>
                        <option value="C11">C-11</option>
                    </select>
                </div>
                <button id="limpiar-filtros-btn" class="btn-outline">Limpiar Filtros</button>
            </div>

            <!-- Tabla de Expedientes -->
            <div class="crud-table-container">
                <table id="expedientes-table" class="crud-table">
                    <thead>
                        <tr>
                            <th>N¬∞ Expediente</th>
                            <th>A√±o</th>
                            <th>Fecha</th>
                            <th>N¬∞ Resoluci√≥n</th>
                            <th>Empresa</th>
                            <th>Unidad</th>
                            <th>Tarjetas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="expedientes-tbody">
                        <!-- Los expedientes se cargar√°n aqu√≠ -->
                    </tbody>
                </table>
            </div>

            <!-- Paginaci√≥n -->
            <div class="crud-pagination">
                <div class="pagination-info">
                    <span id="pagination-info">Mostrando 0 de 0 expedientes</span>
                </div>
                <div class="pagination-controls">
                    <button id="prev-page" class="btn-outline" disabled>¬´ Anterior</button>
                    <span id="page-info">P√°gina 1 de 1</span>
                    <button id="next-page" class="btn-outline" disabled>Siguiente ¬ª</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Secci√≥n de Gesti√≥n de Tarjetas -->
    <div id="vista-tarjetas-crud" class="vista-container">
        <div class="crud-container">
            <div class="crud-header">
                <h2>üé´ Gesti√≥n de Tarjetas</h2>
                <div class="crud-actions">
                    <button id="nueva-tarjeta-btn" class="btn-primary">
                        ‚ûï Nueva Tarjeta
                    </button>
                    <div class="search-crud">
                        <input type="text" id="search-crud-tarjetas-input" placeholder="Buscar por placa o n√∫mero..." />
                        <button id="search-crud-tarjetas-btn" class="btn-secondary">üîç</button>
                    </div>
                </div>
            </div>

            <!-- Filtros -->
            <div class="crud-filters">
                <button id="limpiar-filtros-tarjetas-btn" class="btn-outline">Limpiar Filtros</button>
                <div class="filter-stats">
                    <span id="stats-tarjetas">Total: 0 tarjetas</span>
                </div>
            </div>

            <!-- Tabla de Tarjetas -->
            <div class="crud-table-container">
                <table id="tarjetas-table" class="crud-table">
                    <thead>
                        <tr>
                            <th>Placa</th>
                            <th>N¬∞ Tarjeta</th>
                            <th>Expediente</th>
                            <th>Acta de Entrega</th>
                            <th>Fecha Creaci√≥n</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tarjetas-tbody">
                        <!-- Las tarjetas se cargar√°n aqu√≠ -->
                    </tbody>
                </table>
            </div>

            <!-- Paginaci√≥n -->
            <div class="crud-pagination">
                <div class="pagination-info">
                    <span id="pagination-info-tarjetas">Mostrando 0 de 0 tarjetas</span>
                </div>
                <div class="pagination-controls">
                    <button id="prev-page-tarjetas" class="btn-outline" disabled>¬´ Anterior</button>
                    <span id="page-info-tarjetas">P√°gina 1 de 1</span>
                    <button id="next-page-tarjetas" class="btn-outline" disabled>Siguiente ¬ª</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Expediente -->
    <div id="modal-expediente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Editar Expediente</h3>
                <button id="modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="modal-expediente-form">
                    <!-- Los campos del formulario se cargar√°n aqu√≠ -->
                </form>
            </div>
            <div class="modal-footer">
                <button id="modal-cancelar" class="btn-outline">Cancelar</button>
                <button id="modal-guardar" class="btn-primary">Guardar Cambios</button>
                <button id="modal-eliminar" class="btn-danger">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Tarjeta -->
    <div id="modal-tarjeta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-tarjeta-title">Nueva Tarjeta</h3>
                <button id="modal-tarjeta-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="modal-tarjeta-form">
                    <!-- Los campos del formulario se cargar√°n din√°micamente -->
                </form>
            </div>
            <div class="modal-footer">
                <button id="modal-tarjeta-cancelar" class="btn-outline">Cancelar</button>
                <button id="modal-tarjeta-guardar" class="btn-primary">Guardar</button>
                <button id="modal-tarjeta-eliminar" class="btn-danger" style="display: none;">Eliminar</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts de prueba y diagn√≥stico -->
    <script src="../scripts/test-connection.js"></script>
    <script src="../scripts/test-tarjetas.js"></script>
    <script src="../scripts/test-delete.js"></script>
    <script src="../scripts/diagnostico-db.js"></script>
    <script src="../scripts/auto-migrate-tarjetas.js"></script>
    <script type="module" src="js/main.js"></script>
    <script>
        // Configuraci√≥n de PDF.js worker
        if (typeof window !== 'undefined' && !window.pdfjsWorkerSrc) {
            window.pdfjsWorkerSrc = 'node_modules/pdfjs-dist/build/pdf.worker.js';
        }
        
        // Shortcut para diagn√≥stico: Ctrl+Alt+D
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.altKey && e.key === 'd') {
                console.clear();
                diagnosticarBaseDatos();
            }
        });
    </script>
</body>
</html>